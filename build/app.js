!function(t){var e={};function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=6)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1),i=o(8),a=o(3),n=document.getElementById("canvas");n.width=s.CANVAS_WIDTH,n.height=s.CANVAS_HEIGHT,n.style.width=1!==s.SCALE?s.SCALE*s.CANVAS_WIDTH+"px":"auto",n.style.height=1!==s.SCALE?s.SCALE*s.CANVAS_HEIGHT+"px":"auto",e.context=n.getContext("2d");class l{static clear(){e.context.clearRect(0,0,n.width,n.height)}static drawBox(t){e.context.strokeStyle=t.color,e.context.lineWidth=1,e.context.beginPath(),e.context.moveTo(.5+t.x,.5+t.y),e.context.lineTo(-.5+t.x+s.TILE_SIZE,.5+t.y),e.context.lineTo(-.5+t.x+s.TILE_SIZE,-.5+t.y+s.TILE_SIZE),e.context.lineTo(.5+t.x,-.5+t.y+s.TILE_SIZE),e.context.lineTo(.5+t.x,.5+t.y),e.context.moveTo(.5+t.x,.5+t.y),e.context.lineTo(-.5+t.x+s.TILE_SIZE,-.5+t.y+s.TILE_SIZE),e.context.moveTo(-.5+t.x+s.TILE_SIZE,.5+t.y),e.context.lineTo(.5+t.x,-.5+t.y+s.TILE_SIZE),e.context.stroke()}static calculateTheta(t){const o=Math.atan2(this.getCanvasMouseY()-this.center.y,this.getCanvasMouseX()-this.center.x);return e.context.fillStyle="#44FF44",e.context.fillText(`Î¸ = ${o}`,10,56),o}static drawPlayer(t,o){e.context.beginPath(),e.context.fillStyle="#00AA00",e.context.font="10px Monospace",e.context.fillText(`p (${t.x}, ${t.y})`,10,20),e.context.strokeStyle="#523DA5",e.context.lineWidth=2,e.context.moveTo(this.center.x,this.center.y),e.context.lineTo(this.center.x+t.sightLineLength*Math.cos(o),this.center.y+t.sightLineLength*Math.sin(o)),e.context.stroke()}static drawCrosshair(){const t=l.getCanvasMouseX(),o=l.getCanvasMouseY();let s,i;e.context.strokeStyle="#FFFFFF",e.context.lineWidth=.5,e.context.beginPath(),s=.5,i=-1.5,e.context.moveTo(t+s,o+i),i=-3.5,e.context.lineTo(t+s,o+i),i=2.5,e.context.moveTo(t+s,o+i),i=4.5,e.context.lineTo(t+s,o+i),i=.5,s=-3.5,e.context.moveTo(t+s,o+i),s=-1.5,e.context.lineTo(t+s,o+i),s=2.5,e.context.moveTo(t+s,o+i),s=4.5,e.context.lineTo(t+s,o+i),e.context.stroke()}static drawPlayerVisionRay(t,e){const{hitPoint:o,hitObject:s}=i.default.cast(t,e);o&&(s?this.drawRay(o,"#FF4444"):this.drawRay(o))}static drawProjectiles(t,o,s){e.context.fillStyle="#FFFFFF",e.context.lineWidth=1,t.forEach(t=>{e.context.beginPath(),e.context.arc(t.x+this.center.x-o,t.y+this.center.y-s,2,0,2*Math.PI),e.context.stroke()})}static drawRay(t,o="#4444FF"){e.context.strokeStyle=o,e.context.lineWidth=.5,e.context.beginPath(),e.context.moveTo(this.center.x,this.center.y),e.context.lineTo(this.center.x+t.x,this.center.y+t.y),e.context.stroke(),e.context.lineWidth=1}}l.rows=Math.floor(n.height/s.TILE_SIZE),l.cols=Math.floor(n.width/s.TILE_SIZE),l.halfRows=Math.floor(n.height/2/s.TILE_SIZE),l.halfCols=Math.floor(n.width/2/s.TILE_SIZE),l.rowRemainder=n.height/2%s.TILE_SIZE,l.colRemainder=n.width/2%s.TILE_SIZE,l.center={x:s.CANVAS_WIDTH/2,y:s.CANVAS_HEIGHT/2},l.getCanvasDomElement=(()=>n),l.getCanvasMouseX=(()=>Math.floor((a.default.x-n.offsetLeft)/s.SCALE)),l.getCanvasMouseY=(()=>Math.floor((a.default.y-n.offsetTop)/s.SCALE)),e.default=l},function(t){t.exports={CANVAS_WIDTH:480,CANVAS_HEIGHT:320,TILE_SIZE:32,SCALE:2,RAYCASTER:{DEBUG:!1}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1),i=o(0),a=o(9),n=o(12);e.gameObjects=[];e.default=class{constructor(t,e){this.grid=t,this.player=e,this.loadMap(n)}draw(){let t=this.player.deltas.dxLeft-i.default.colRemainder,o=this.player.deltas.dyTop-i.default.rowRemainder;const a=this.player.row-i.default.halfRows,n=this.player.col-i.default.halfCols;let l;for(let c=a;c<a+i.default.rows+1;++c)for(let r=n-1;r<n+i.default.cols+1;++r)e.gameObjects[c]&&e.gameObjects[c][r]&&((l=e.gameObjects[c][r]).x=(r-n)*s.TILE_SIZE-t,l.y=(c-a)*s.TILE_SIZE-o,l.draw())}loadMap(t){for(let o=0;o<t.length;++o){e.gameObjects[o]=[];for(let s=0;s<t[o].length;++s)switch(t[o][s]){case 1:e.gameObjects[o][s]=a.default.createBox("#4B4B4B",o,s,!1);break;case 2:e.gameObjects[o][s]=a.default.createBox("#27531B",o,s);break;case 3:e.gameObjects[o][s]=a.default.createBox("#572F17",o,s);break;default:e.gameObjects[o][s]=null}}}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(0);class i{static init(t){this.hijackRightClick(),this.trackMouseOnCanvas(),this.listenForLeftClicks(t)}static hijackRightClick(){window.addEventListener("contextmenu",t=>{t.preventDefault()},!1)}static trackMouseOnCanvas(){s.default.getCanvasDomElement().addEventListener("mousemove",t=>{this.x=t.pageX,this.y=t.pageY},!1)}static listenForLeftClicks(t){const e=s.default.getCanvasDomElement();e.addEventListener("mousedown",e=>{t.setShooting(!0)},!1),e.addEventListener("mouseup",e=>{t.setShooting(!1)},!1)}}i.x=0,i.y=0,e.default=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(17),i=o(5),a=o(18);class n{static async load(){this.SMG[0]=await a.load("./audio/smg_1.wav"),this.SMG[1]=await a.load("./audio/smg_2.wav"),this.SMG[2]=await a.load("./audio/smg_3.wav"),this.SMG[3]=await a.load("./audio/smg_4.wav"),this.SMG[4]=await a.load("./audio/smg_5.wav")}static playSMG(){const t=i.default.createBufferSource();t.buffer=this.SMG[this.SMG_INDEX];const e=i.default.createGain();e.gain.value=s.default.soundFxVolume,t.connect(e),e.connect(i.default.destination),t.start(),this.SMG_INDEX=++this.SMG_INDEX%this.SMG.length}}n.SMG=[],n.SMG_INDEX=0,e.default=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=new AudioContext;e.default=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),(new(o(7).default)).start()},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(0),i=o(3),a=o(13),n=o(14),l=o(2),c=o(15);o(19).default.load();const r=new n.default,h=new c.default(128,64),d=new l.default(r,h);a.default.init(h),i.default.init(h);e.default=class{start(){window.requestAnimationFrame(()=>this.gameLoop())}gameLoop(){this.update(),this.render(),window.requestAnimationFrame(()=>this.gameLoop())}update(){h.update()}render(){s.default.clear(),d.draw(),h.draw()}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1),i=o(2),a=o(0);class n{static cast(t,e){if(e>=0){t.deltas.dyBottom;const o=t.deltas.dyBottom/Math.tan(e);return o>=0?n.getInterceptPointSE(t,e):o<0?n.getInterceptPointSW(t,e):{hitPoint:null,hitObject:null}}return{hitPoint:null,hitObject:null}}static getInterceptPointSE(t,e){let o,i,l=null,c=null,r=0;for(;i=r*s.TILE_SIZE,o=0===e?0:(t.deltas.dxRight+i)*Math.tan(e),!(i+t.deltas.dxRight>a.default.center.x||o>a.default.center.y);){if(s.RAYCASTER.DEBUG&&(a.context.beginPath(),a.context.arc(a.default.center.x+t.deltas.dxRight+i,a.default.center.y+o,2,0,2*Math.PI),a.context.stroke()),c=n.checkGameObjectCollisionVertical(r,t,o)){l={x:i+t.deltas.dxRight,y:o};break}++r}let h,d,u=null,f=null,x=0;for(;!(d=x*s.TILE_SIZE,0===e||(h=(t.deltas.dyBottom+d)/Math.tan(e),d+t.deltas.dyBottom>a.default.center.y||h>a.default.center.x)||(s.RAYCASTER.DEBUG&&(a.context.strokeStyle="#44FF44",a.context.beginPath(),a.context.arc(a.default.center.x+h,a.default.center.y+t.deltas.dyBottom+d,2,0,2*Math.PI),a.context.stroke()),o<d));){if(f=n.checkGameObjectCollisionHorizontal(x,t,h)){u={x:h,y:d+t.deltas.dyBottom};break}++x}if(l&&null===u)return{hitPoint:l,hitObject:c};if(u&&null===l)return{hitPoint:u,hitObject:f};if(u&&l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))>Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2))?{hitPoint:u,hitObject:f}:{hitPoint:l,hitObject:c}}if(null===u&&null===l){const e={x:h,y:d+t.deltas.dyBottom},s={x:i+t.deltas.dxRight,y:o};return Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2))>Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))?{hitPoint:e,hitObject:f}:{hitPoint:s,hitObject:c}}}static getInterceptPointSW(t,e){let o,i,l=null,c=null,r=0;for(;i=r*s.TILE_SIZE,o=0===e?0:(t.deltas.dxLeft+i)*Math.tan(Math.PI-e),!(i+t.deltas.dxLeft>a.default.center.x||o>a.default.center.y);){if(s.RAYCASTER.DEBUG&&(a.context.beginPath(),a.context.arc(a.default.center.x-t.deltas.dxLeft-i,a.default.center.y+o,2,0,2*Math.PI),a.context.stroke()),c=n.checkGameObjectCollisionVerticalSW(r,t,o)){l={x:-i-t.deltas.dxLeft,y:o};break}++r}let h,d,u=null,f=null,x=0;for(;!(d=x*s.TILE_SIZE,0===e||(h=(t.deltas.dyBottom+d)/Math.tan(e),d+t.deltas.dyBottom>a.default.center.y||h>a.default.center.x)||(s.RAYCASTER.DEBUG&&(a.context.strokeStyle="#44FF44",a.context.beginPath(),a.context.arc(a.default.center.x+h,a.default.center.y+t.deltas.dyBottom+d,2,0,2*Math.PI),a.context.stroke()),o<d));){if(f=n.checkGameObjectCollisionHorizontalSW(x,t,h)){u={x:h,y:d+t.deltas.dyBottom},a.context.fillText(`hitPointHorz: ${u.x}, ${u.y}`,250,20);break}++x}if(l&&null===u)return{hitPoint:l,hitObject:c};if(u&&null===l)return{hitPoint:u,hitObject:f};if(u&&l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))>Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2))?{hitPoint:u,hitObject:f}:{hitPoint:l,hitObject:c}}if(null===u&&null===l){const e={x:h,y:d+t.deltas.dyBottom},s={x:-i-t.deltas.dxLeft,y:o};return Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2))>Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))?{hitPoint:e,hitObject:f}:{hitPoint:s,hitObject:c}}}static checkGameObjectCollisionVertical(t,e,o){const n=1+e.col+t,l=e.row+Math.floor((e.deltas.dyTop+o)/s.TILE_SIZE);let c=null;return i.gameObjects[l]&&i.gameObjects[l][n]&&(c=i.gameObjects[l][n]),s.RAYCASTER.DEBUG&&a.context.fillText(`col: ${n}, row: ${l}, hit: ${c?[c.row,c.col]:null}`,10,112+12*t),c}static checkGameObjectCollisionHorizontal(t,e,o){const n=e.col+Math.floor((e.deltas.dxLeft+o)/s.TILE_SIZE),l=e.row+t+1;let c=null;return i.gameObjects[l]&&i.gameObjects[l][n]&&(c=i.gameObjects[l][n]),s.RAYCASTER.DEBUG&&a.context.fillText(`col: ${n}, row: ${l}, hit: ${c?[c.row,c.col]:null}`,10,212+12*t),c}static checkGameObjectCollisionVerticalSW(t,e,o){const n=e.col-t-1,l=e.row+Math.floor((e.deltas.dyTop+o)/s.TILE_SIZE);let c=null;return i.gameObjects[l]&&i.gameObjects[l][n]&&(c=i.gameObjects[l][n]),s.RAYCASTER.DEBUG&&a.context.fillText(`col: ${n}, row: ${l}, hit: ${c?[c.row,c.col]:null}`,10,112+12*t),c}static checkGameObjectCollisionHorizontalSW(t,e,o){const n=e.col-Math.floor((e.deltas.dxRight-o)/s.TILE_SIZE),l=e.row+t+1;let c=null;return i.gameObjects[l]&&i.gameObjects[l][n]&&(c=i.gameObjects[l][n]),s.RAYCASTER.DEBUG&&a.context.fillText(`col: ${n}, row: ${l}, hit: ${c?[c.row,c.col]:null}`,10,212+12*t),c}}e.default=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1),i=o(10);e.default=class{static createBox(t,e,o,a=!0){return new i.default(t,e,o,s.TILE_SIZE,s.TILE_SIZE,a)}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(0),i=o(11);e.default=class extends i.default{draw(){s.default.drawBox(this)}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1);e.default=class{constructor(t,e,o,i,a,n=!0){this.color=t,this.row=e,this.col=o,this.width=i,this.height=a,this.destructable=n,this.mapX=o*s.TILE_SIZE,this.mapY=e*s.TILE_SIZE}}},function(t){t.exports=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],[1,0,3,0,0,0,0,0,0,0,1,0,2,3,0,1,0,0,0,0,0,1],[1,0,0,3,0,0,0,0,0,0,1,0,2,2,0,1,0,0,3,2,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,0,0,2,2,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,0,1],[1,0,0,0,0,0,3,3,3,0,2,0,0,0,0,1,0,3,2,2,0,1],[1,0,0,0,0,0,3,3,3,0,2,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,0,0,3,3,3,0,2,0,0,1,0,1,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static init(t){document.addEventListener("keydown",e=>{switch(e.keyCode){case 87:t.moving.up=!0;break;case 65:t.moving.left=!0;break;case 83:t.moving.down=!0;break;case 68:t.moving.right=!0}}),document.addEventListener("keyup",e=>{switch(e.keyCode){case 87:t.moving.up=!1;break;case 65:t.moving.left=!1;break;case 83:t.moving.down=!1;break;case 68:t.moving.right=!1}})}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1);e.default=class{constructor(){this.rows=s.CANVAS_HEIGHT/s.TILE_SIZE,this.cols=s.CANVAS_WIDTH/s.TILE_SIZE}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(1),i=o(0),a=o(16),n=o(2),l=o(4);e.default=class{constructor(t,e){this.x=t,this.y=e,this.rotation=0,this.moving={left:!1,right:!1,up:!1,down:!1},this.sightLineLength=10,this.deltas={dyTop:0,dyBottom:0,dxLeft:0,dxRight:0},this.maxSpeed=4,this.shooting=!1,this.shootingCooldown=6,this.projectiles=[],this.updateMapPosition()}update(){this.move(),this.updateTileDeltas(),this.shoot(),this.projectiles.forEach((t,e)=>{t.update(this.x,this.y),!1===t.alive&&this.projectiles.splice(e,1)})}move(){this.moving.left&&(this.x-=this.maxSpeed),this.moving.right&&(this.x+=this.maxSpeed),this.moving.up&&(this.y-=this.maxSpeed),this.moving.down&&(this.y+=this.maxSpeed),this.adjustCollisionWithGameObjects(),this.updateMapPosition()}shoot(){if(this.shooting&&this.shootingCooldown<=0){const t=i.default.getCanvasMouseX(),e=i.default.getCanvasMouseY(),o=t-i.default.center.x,s=e-i.default.center.y;let n=o/(Math.abs(o)+Math.abs(s)),c=s/(Math.abs(o)+Math.abs(s));const r=.1*Math.random()-.05,h=.1*Math.random()-.05;n+=r,c+=h,this.projectiles.push(new a.default(this.x,this.y,n,c)),this.shootingCooldown=6,l.default.playSMG()}else--this.shootingCooldown}draw(){const t=i.default.calculateTheta(this);i.default.drawPlayer(this,t),i.default.drawPlayerVisionRay(this,t),i.default.drawCrosshair(),i.default.drawProjectiles(this.projectiles,this.x,this.y)}setShooting(t){this.shooting=t}updateMapPosition(){this.row=Math.floor(this.y/s.TILE_SIZE),this.col=Math.floor(this.x/s.TILE_SIZE)}updateTileDeltas(){this.deltas.dyTop=this.y%s.TILE_SIZE,this.deltas.dyBottom=s.TILE_SIZE-this.deltas.dyTop,this.deltas.dxLeft=this.x%s.TILE_SIZE,this.deltas.dxRight=s.TILE_SIZE-this.deltas.dxLeft}adjustCollisionWithGameObjects(){let t;n.gameObjects[this.row]&&((t=n.gameObjects[this.row][this.col-1])&&this.x<=t.mapX+t.width&&(this.x=t.mapX+t.width+1),(t=n.gameObjects[this.row][this.col+1])&&this.x>=t.mapX&&(this.x=t.mapX-1)),n.gameObjects[this.row-1]&&((t=n.gameObjects[this.row-1][this.col])&&this.y<=t.mapY+t.height&&(this.y=t.mapY+t.height+1),(t=n.gameObjects[this.row-1][this.col+1])&&this.y<=t.mapY+t.height&&this.x>=t.mapX&&(this.y=t.mapY+t.height+1),(t=n.gameObjects[this.row-1][this.col-1])&&this.y<=t.mapY+t.height&&this.x<=t.mapX+t.width&&(this.y=t.mapY+t.height+1)),n.gameObjects[this.row+1]&&((t=n.gameObjects[this.row+1][this.col])&&this.y>=t.mapY&&(this.y=t.mapY-1),(t=n.gameObjects[this.row+1][this.col+1])&&this.x>=t.mapX&&this.y>=t.mapY&&(this.y=t.mapY-1),(t=n.gameObjects[this.row+1][this.col-1])&&this.x<=t.mapX+t.width&&this.y>=t.mapY&&(this.y=t.mapY-1))}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(0),i=o(2);e.default=class{constructor(t,e,o,s){this.x=t,this.y=e,this.directionX=o,this.directionY=s,this.speed=24,this.alive=!0}update(t,e){let o;this.x+=this.directionX*this.speed,this.y+=this.directionY*this.speed,(this.x<t-s.default.center.x||this.x>t+s.default.center.x||this.y<e-s.default.center.y||this.y>e+s.default.center.y)&&(this.alive=!1);for(let t=0;t<i.gameObjects.length;++t)for(let e=0;e<i.gameObjects[t].length;++e)(o=i.gameObjects[t][e])&&this.x>=o.mapX&&this.x<=o.mapX+o.width&&this.y>=o.mapY&&this.y<=o.mapY+o.height&&(this.alive=!1,i.gameObjects[t][e].destructable&&(i.gameObjects[t][e]=null))}}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static get musicVolume(){return this._musicVolume}static set musicVolume(t){t>=0&&t<=1&&(this._musicVolume=t)}static get soundFxVolume(){return this._soundFxVolume}static set soundFxVolume(t){t>=0&&t<=1&&(this._soundFxVolume=t)}}s._musicVolume=.3,s._soundFxVolume=.3,e.default=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(5);e.load=function(t){return new Promise((e,o)=>{const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=(()=>{s.default.decodeAudioData(i.response,t=>e(t))}),i.send()})}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=o(4);e.default=class{static async load(){await s.default.load()}}}]);
//# sourceMappingURL=app.js.map