!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),a=s(3),o=document.getElementById("canvas");o.width=i.CANVAS_WIDTH,o.height=i.CANVAS_HEIGHT,o.style.width=1!==i.SCALE?i.SCALE*i.CANVAS_WIDTH+"px":"auto",o.style.height=1!==i.SCALE?i.SCALE*i.CANVAS_HEIGHT+"px":"auto";const n=o.getContext("2d");class r{static clear(){n.clearRect(0,0,o.width,o.height)}static drawBox(t){n.strokeStyle=t.color,n.lineWidth=1,n.beginPath(),n.moveTo(.5+t.x,.5+t.y),n.lineTo(-.5+t.x+i.TILE_SIZE,.5+t.y),n.lineTo(-.5+t.x+i.TILE_SIZE,-.5+t.y+i.TILE_SIZE),n.lineTo(.5+t.x,-.5+t.y+i.TILE_SIZE),n.lineTo(.5+t.x,.5+t.y),n.moveTo(.5+t.x,.5+t.y),n.lineTo(-.5+t.x+i.TILE_SIZE,-.5+t.y+i.TILE_SIZE),n.moveTo(-.5+t.x+i.TILE_SIZE,.5+t.y),n.lineTo(.5+t.x,-.5+t.y+i.TILE_SIZE),n.stroke()}static drawPlayer(t){n.beginPath(),n.fillStyle="#00AA00",n.font="10px Monospace",n.fillText(`p (${t.x}, ${t.y})`,10,20);const e=r.getCanvasMouseX(),s=r.getCanvasMouseY();n.fillText(`m (${e}, ${s})`,10,32);const i=e-this.center.x,a=s-this.center.y;n.fillText(`d (${i}, ${a})`,10,44);const o=Math.atan2(a,i);n.fillText(`Î¸ = ${o}`,10,56),n.strokeStyle="#523DA5",n.lineWidth=2,n.moveTo(this.center.x,this.center.y),n.lineTo(this.center.x+t.sightLineLength*Math.cos(o),this.center.y+t.sightLineLength*Math.sin(o)),n.stroke()}static drawCrosshair(){const t=r.getCanvasMouseX(),e=r.getCanvasMouseY();let s,i;n.strokeStyle="#FFFFFF",n.lineWidth=.5,n.beginPath(),s=.5,i=-1.5,n.moveTo(t+s,e+i),i=-3.5,n.lineTo(t+s,e+i),i=2.5,n.moveTo(t+s,e+i),i=4.5,n.lineTo(t+s,e+i),i=.5,s=-3.5,n.moveTo(t+s,e+i),s=-1.5,n.lineTo(t+s,e+i),s=2.5,n.moveTo(t+s,e+i),s=4.5,n.lineTo(t+s,e+i),n.stroke()}static drawPlayerVisionRay(t){const e=r.getCanvasMouseX(),s=r.getCanvasMouseY();n.strokeStyle="#FF4444",n.lineWidth=.1,n.beginPath(),n.moveTo(this.center.x,this.center.y),n.lineTo(e,s),n.stroke();const a=this.getCanvasMouseX()-this.center.x,o=this.getCanvasMouseY()-this.center.y,l=Math.atan2(o,a);n.beginPath(),n.strokeStyle="#FF4444",n.lineWidth=.5;const h=i.TILE_SIZE-t.x%i.TILE_SIZE,c=t.x%i.TILE_SIZE;if(l>=0){const e=i.TILE_SIZE-t.y%i.TILE_SIZE,s=(i.TILE_SIZE-t.y%i.TILE_SIZE)/Math.tan(l);if(s>0&&s>h){const t=h*Math.tan(l);n.arc(this.center.x+h,this.center.y+t,2,0,2*Math.PI)}else if(s<0&&-s>c){const t=c*Math.tan(Math.PI-l);n.arc(this.center.x-c,this.center.y+t,2,0,2*Math.PI)}else n.arc(this.center.x+s,this.center.y+e,2,0,2*Math.PI)}else{const e=t.y%i.TILE_SIZE,s=t.y%i.TILE_SIZE/Math.tan(-l);if(s>0&&s>h){const t=h*Math.tan(-l);n.arc(this.center.x+h,this.center.y-t,2,0,2*Math.PI)}else if(s<0&&-s>c){const t=c*Math.tan(Math.PI-l);n.arc(this.center.x-c,this.center.y+t,2,0,2*Math.PI)}else n.arc(this.center.x+s,this.center.y-e,2,0,2*Math.PI)}n.stroke()}static drawProjectiles(t,e,s){n.fillStyle="#FFFFFF",n.lineWidth=1,t.forEach(t=>{n.beginPath(),n.arc(t.x+this.center.x-e,t.y+this.center.y-s,2,0,2*Math.PI),n.stroke()})}}r.rows=Math.floor(o.height/i.TILE_SIZE),r.cols=Math.floor(o.width/i.TILE_SIZE),r.halfRows=Math.floor(o.height/2/i.TILE_SIZE),r.halfCols=Math.floor(o.width/2/i.TILE_SIZE),r.rowRemainder=o.height/2%i.TILE_SIZE,r.colRemainder=o.width/2%i.TILE_SIZE,r.center={x:i.CANVAS_WIDTH/2,y:i.CANVAS_HEIGHT/2},r.getCanvasDomElement=(()=>o),r.getCanvasMouseX=(()=>Math.floor((a.default.x-o.offsetLeft)/i.SCALE)),r.getCanvasMouseY=(()=>Math.floor((a.default.y-o.offsetTop)/i.SCALE)),e.default=r},function(t){t.exports={CANVAS_WIDTH:480,CANVAS_HEIGHT:320,TILE_SIZE:32,SCALE:2}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),a=s(0),o=s(10),n=s(13);e.gameObjects=[];e.default=class{constructor(t,e){this.grid=t,this.player=e,this.loadMap(n)}draw(){let t=this.player.x%i.TILE_SIZE-a.default.colRemainder,s=this.player.y%i.TILE_SIZE-a.default.rowRemainder;this.player.col<0&&(t===-a.default.colRemainder&&(t=-(i.TILE_SIZE+a.default.colRemainder)),t+=i.TILE_SIZE),this.player.row<0&&(1/s==-1/0&&(s=-i.TILE_SIZE),s+=i.TILE_SIZE);const o=this.player.row-a.default.halfRows,n=this.player.col-a.default.halfCols;let r;for(let l=o;l<o+a.default.rows+1;++l)for(let h=n;h<n+a.default.cols+1;++h)e.gameObjects[l]&&e.gameObjects[l][h]&&((r=e.gameObjects[l][h]).x=(h-n)*i.TILE_SIZE-t,r.y=(l-o)*i.TILE_SIZE-s,r.draw())}loadMap(t){for(let s=0;s<t.length;++s){e.gameObjects[s]=[];for(let i=0;i<t[s].length;++i)switch(t[s][i]){case 1:e.gameObjects[s][i]=o.default.createBox("#572F17",s,i);break;case 2:e.gameObjects[s][i]=o.default.createBox("#403550",s,i);break;case 3:e.gameObjects[s][i]=o.default.createBox("#27531B",s,i);break;default:e.gameObjects[s][i]=null}}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);class a{static init(t){this.hijackRightClick(),this.trackMouseOnCanvas(),this.listenForLeftClicks(t)}static hijackRightClick(){window.addEventListener("contextmenu",t=>{t.preventDefault()},!1)}static trackMouseOnCanvas(){i.default.getCanvasDomElement().addEventListener("mousemove",t=>{this.x=t.pageX,this.y=t.pageY},!1)}static listenForLeftClicks(t){const e=i.default.getCanvasDomElement();e.addEventListener("mousedown",e=>{t.setShooting(!0)},!1),e.addEventListener("mouseup",e=>{t.setShooting(!1)},!1)}}a.x=0,a.y=0,e.default=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(16),a=s(5),o=s(17);class n{static async load(){this.SMG[0]=await o.load("./audio/smg_1.wav"),this.SMG[1]=await o.load("./audio/smg_2.wav"),this.SMG[2]=await o.load("./audio/smg_3.wav"),this.SMG[3]=await o.load("./audio/smg_4.wav"),this.SMG[4]=await o.load("./audio/smg_5.wav")}static playSMG(){const t=a.default.createBufferSource();t.buffer=this.SMG[this.SMG_INDEX];const e=a.default.createGain();e.gain.value=i.default.soundFxVolume,t.connect(e),e.connect(a.default.destination),t.start(),this.SMG_INDEX=++this.SMG_INDEX%this.SMG.length}}n.SMG=[],n.SMG_INDEX=0,e.default=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=new AudioContext;e.default=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),(new(s(7).default)).start()},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),a=s(3),o=s(8),n=s(9),r=s(2),l=s(14);s(18).default.load();const h=new n.default,c=new l.default(128,64),u=new r.default(h,c);o.default.init(c),a.default.init(c);e.default=class{start(){window.requestAnimationFrame(()=>this.gameLoop())}gameLoop(){this.update(),this.render(),window.requestAnimationFrame(()=>this.gameLoop())}update(){c.update()}render(){i.default.clear(),u.draw(),c.draw()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static init(t){document.addEventListener("keydown",e=>{switch(e.keyCode){case 87:t.moving.up=!0;break;case 65:t.moving.left=!0;break;case 83:t.moving.down=!0;break;case 68:t.moving.right=!0}}),document.addEventListener("keyup",e=>{switch(e.keyCode){case 87:t.moving.up=!1;break;case 65:t.moving.left=!1;break;case 83:t.moving.down=!1;break;case 68:t.moving.right=!1}})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.default=class{constructor(){this.rows=i.CANVAS_HEIGHT/i.TILE_SIZE,this.cols=i.CANVAS_WIDTH/i.TILE_SIZE}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),a=s(11);e.default=class{static createBox(t,e,s){return new a.default(t,e,s,i.TILE_SIZE,i.TILE_SIZE)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),a=s(12);e.default=class extends a.default{draw(){i.default.drawBox(this)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.default=class{constructor(t,e,s,a,o){this.color=t,this.row=e,this.col=s,this.width=a,this.height=o,this.mapX=s*i.TILE_SIZE,this.mapY=e*i.TILE_SIZE}}},function(t){t.exports=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1],[1,0,3,0,0,0,0,0,0,0,1,0,2,3,0,1],[1,0,0,3,0,0,0,0,0,0,1,0,2,2,0,1],[2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3],[2,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3],[1,0,0,0,0,0,2,2,2,0,0,0,0,0,0,1],[1,0,0,0,0,0,2,2,2,0,0,0,0,0,0,1],[1,0,1,0,0,0,2,2,2,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),a=s(0),o=s(15),n=s(2),r=s(4);e.default=class{constructor(t,e){this.x=t,this.y=e,this.rotation=0,this.maxSpeed=4,this.moving={left:!1,right:!1,up:!1,down:!1},this.sightLineLength=10,this.shooting=!1,this.shootingCooldown=6,this.projectiles=[],this.updateMapPosition()}update(){this.move(),this.shoot(),this.projectiles.forEach((t,e)=>{t.update(this.x,this.y),!1===t.alive&&this.projectiles.splice(e,1)})}move(){this.moving.left&&(this.x-=this.maxSpeed),this.moving.right&&(this.x+=this.maxSpeed),this.moving.up&&(this.y-=this.maxSpeed),this.moving.down&&(this.y+=this.maxSpeed),this.adjustCollisionWithGameObjects(),this.updateMapPosition()}adjustCollisionWithGameObjects(){let t;n.gameObjects[this.row]&&((t=n.gameObjects[this.row][this.col-1])&&this.x<=t.mapX+t.width&&(this.x=t.mapX+t.width+1),(t=n.gameObjects[this.row][this.col+1])&&this.x>=t.mapX&&(this.x=t.mapX-1)),n.gameObjects[this.row-1]&&((t=n.gameObjects[this.row-1][this.col])&&this.y<=t.mapY+t.height&&(this.y=t.mapY+t.height+1),(t=n.gameObjects[this.row-1][this.col+1])&&this.y<=t.mapY+t.height&&this.x>=t.mapX&&(this.y=t.mapY+t.height+1),(t=n.gameObjects[this.row-1][this.col-1])&&this.y<=t.mapY+t.height&&this.x<=t.mapX+t.width&&(this.y=t.mapY+t.height+1)),n.gameObjects[this.row+1]&&((t=n.gameObjects[this.row+1][this.col])&&this.y>=t.mapY&&(this.y=t.mapY-1),(t=n.gameObjects[this.row+1][this.col+1])&&this.x>=t.mapX&&this.y>=t.mapY&&(this.y=t.mapY-1),(t=n.gameObjects[this.row+1][this.col-1])&&this.x<=t.mapX+t.width&&this.y>=t.mapY&&(this.y=t.mapY-1))}updateMapPosition(){this.row=Math.floor(this.y/i.TILE_SIZE),this.col=Math.floor(this.x/i.TILE_SIZE)}shoot(){if(this.shooting&&this.shootingCooldown<=0){const t=a.default.getCanvasMouseX(),e=a.default.getCanvasMouseY(),s=t-a.default.center.x,i=e-a.default.center.y;let n=s/(Math.abs(s)+Math.abs(i)),l=i/(Math.abs(s)+Math.abs(i));const h=.1*Math.random()-.05,c=.1*Math.random()-.05;n+=h,l+=c,this.projectiles.push(new o.default(this.x,this.y,n,l)),this.shootingCooldown=6,r.default.playSMG()}else--this.shootingCooldown}draw(){a.default.drawPlayer(this),a.default.drawPlayerVisionRay(this),a.default.drawCrosshair(),a.default.drawProjectiles(this.projectiles,this.x,this.y)}setShooting(t){this.shooting=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),a=s(2);e.default=class{constructor(t,e,s,i){this.x=t,this.y=e,this.directionX=s,this.directionY=i,this.speed=24,this.alive=!0}update(t,e){let s;this.x+=this.directionX*this.speed,this.y+=this.directionY*this.speed,(this.x<t-i.default.center.x||this.x>t+i.default.center.x||this.y<e-i.default.center.y||this.y>e+i.default.center.y)&&(this.alive=!1);for(let t=0;t<a.gameObjects.length;++t)for(let e=0;e<a.gameObjects[t].length;++e)(s=a.gameObjects[t][e])&&this.x>=s.mapX&&this.x<=s.mapX+s.width&&this.y>=s.mapY&&this.y<=s.mapY+s.height&&(this.alive=!1,a.gameObjects[t][e]=null)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static get musicVolume(){return this._musicVolume}static set musicVolume(t){t>=0&&t<=1&&(this._musicVolume=t)}static get soundFxVolume(){return this._soundFxVolume}static set soundFxVolume(t){t>=0&&t<=1&&(this._soundFxVolume=t)}}i._musicVolume=.3,i._soundFxVolume=.3,e.default=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5);e.load=function(t){return new Promise((e,s)=>{const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer",a.onload=(()=>{i.default.decodeAudioData(a.response,t=>e(t))}),a.send()})}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4);e.default=class{static async load(){await i.default.load()}}}]);
//# sourceMappingURL=app.js.map